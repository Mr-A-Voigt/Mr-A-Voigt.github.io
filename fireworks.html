<!-- ...existing code... -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Realistic Fireworks</title>
  <style>
    html,body { height:100%; margin:0; background:#000; overflow:hidden; }
    canvas { display:block; width:100%; height:100%; }
    .hint {
      position:fixed; left:12px; bottom:12px; color:#ddd; font-family:system-ui,Segoe UI,Roboto; font-size:13px;
      background:rgba(0,0,0,0.4); padding:8px 10px; border-radius:6px; pointer-events:none;
    }
  </style>
</head>
<body>
  <canvas id="c"></canvas>
  <div class="hint">Click / tap to shoot fireworks</div>
  <script>
    (() => {
      const canvas = document.getElementById('c');
      const ctx = canvas.getContext('2d');
      let DPR = Math.max(1, window.devicePixelRatio || 1);

      function resize() {
        DPR = Math.max(1, window.devicePixelRatio || 1);
        canvas.width = Math.floor(window.innerWidth * DPR);
        canvas.height = Math.floor(window.innerHeight * DPR);
        canvas.style.width = window.innerWidth + 'px';
        canvas.style.height = window.innerHeight + 'px';
        ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
      }
      window.addEventListener('resize', resize, {passive:true});
      resize();

      const GRAVITY = 0.06;
      const AIR = 0.995;
      const rockets = [];
      const particles = [];
      const colors = [
        '#ff3f3f','#ff7f50','#ffd700','#7fff7f','#7fffd4','#4fc3ff','#a66bff','#ff77ff'
      ];

      class Rocket {
        constructor(x, y, vx, vy, color) {
          this.x = x; this.y = y; this.vx = vx; this.vy = vy;
          this.color = color || colors[(Math.random()*colors.length)|0];
          this.trail = [];
          this.age = 0;
          this.maxAge = 80 + Math.random() * 40;
        }
        update() {
          this.trail.push({x:this.x, y:this.y});
          if (this.trail.length > 6) this.trail.shift();
          this.vx *= AIR;
          this.vy *= AIR;
          this.vy += GRAVITY * 0.06 * DPR;
          this.x += this.vx;
          this.y += this.vy;
          this.age++;
          // explode by age or when vy becomes positive (starts falling)
          if (this.age > this.maxAge || this.vy > 1) {
            this.explode();
            return true;
          }
          return false;
        }
        explode() {
          const particleCount = 40 + ((Math.random()*80)|0);
          const baseHue = Math.random();
          for (let i=0;i<particleCount;i++){
            const angle = Math.random() * Math.PI * 2;
            const speed = (Math.random() * 4 + 1) * (0.6 + Math.random()*0.8);
            const vx = Math.cos(angle) * speed + this.vx * 0.3;
            const vy = Math.sin(angle) * speed + this.vy * 0.3;
            const life = 50 + (Math.random()*60|0);
            const size = 1 + Math.random()*2.5;
            const hue = baseHue + (Math.random()-0.5)*0.08;
            const color = hsvToRgbString(hue, 0.9, 1);
            particles.push(new Particle(this.x, this.y, vx, vy, life, size, color));
          }
        }
        draw(ctx) {
          ctx.beginPath();
          for (let i=0;i<this.trail.length;i++){
            const p = this.trail[i];
            ctx.lineTo(p.x, p.y);
          }
          ctx.strokeStyle = this.color;
          ctx.lineWidth = 1.5;
          ctx.stroke();
          // head
          ctx.fillStyle = this.color;
          ctx.beginPath();
          ctx.arc(this.x, this.y, 2.5, 0, Math.PI*2);
          ctx.fill();
        }
      }

      class Particle {
        constructor(x,y,vx,vy,life,size,color){
          this.x=x; this.y=y; this.vx=vx; this.vy=vy; this.life=life; this.maxLife=life;
          this.size=size; this.color=color; this.age=0; this.alpha=1;
          this.trail = [];
        }
        update() {
          this.trail.push({x:this.x,y:this.y});
          if (this.trail.length > 6) this.trail.shift();
          this.vx *= (0.985 + Math.random()*0.01);
          this.vy *= (0.985 + Math.random()*0.01);
          this.vy += GRAVITY;
          this.x += this.vx;
          this.y += this.vy;
          this.age++;
          this.alpha = Math.max(0, 1 - this.age / this.maxLife);
          // air drag and slow-down
          return this.age > this.maxLife || this.alpha <= 0;
        }
        draw(ctx) {
          ctx.strokeStyle = this.color;
          ctx.globalAlpha = Math.min(1, this.alpha);
          // trail
          for (let i=0;i<this.trail.length-1;i++){
            const p0 = this.trail[i], p1 = this.trail[i+1];
            ctx.lineWidth = this.size * (i/this.trail.length) * 1.5;
            ctx.beginPath();
            ctx.moveTo(p0.x, p0.y);
            ctx.lineTo(p1.x, p1.y);
            ctx.stroke();
          }
          // glow dot
          ctx.fillStyle = this.color;
          ctx.beginPath();
          ctx.arc(this.x, this.y, this.size, 0, Math.PI*2);
          ctx.fill();
          ctx.globalAlpha = 1;
        }
      }

      function hsvToRgbString(h, s, v) {
        h = (h%1+1)%1;
        let r,g,b;
        const i = Math.floor(h*6);
        const f = h*6 - i;
        const p = v * (1 - s);
        const q = v * (1 - f*s);
        const t = v * (1 - (1-f)*s);
        switch(i%6){
          case 0: r=v; g=t; b=p; break;
          case 1: r=q; g=v; b=p; break;
          case 2: r=p; g=v; b=t; break;
          case 3: r=p; g=q; b=v; break;
          case 4: r=t; g=p; b=v; break;
          case 5: r=v; g=p; b=q; break;
        }
        return 'rgba(' + ((r*255)|0) + ',' + ((g*255)|0) + ',' + ((b*255)|0) + ',1)';
      }

      let lastTime = 0;
      function loop(t){
        const dt = (t - lastTime) / 16.67;
        lastTime = t;
        // fade canvas slightly to create trails
        ctx.globalCompositeOperation = 'destination-out';
        ctx.fillStyle = 'rgba(0,0,0,0.18)';
        ctx.fillRect(0,0,canvas.width/DPR, canvas.height/DPR);
        ctx.globalCompositeOperation = 'lighter';

        // update rockets
        for (let i = rockets.length - 1; i >= 0; i--) {
          const r = rockets[i];
          if (r.update()) rockets.splice(i,1);
        }
        // update particles
        for (let i = particles.length - 1; i >= 0; i--) {
          const p = particles[i];
          if (p.update()) particles.splice(i,1);
        }

        // draw sparks/backlight glow
        ctx.globalCompositeOperation = 'lighter';
        for (const r of rockets) r.draw(ctx);
        for (const p of particles) p.draw(ctx);

        // occasional auto-launch
        if (Math.random() < 0.03) launchRandom();

        requestAnimationFrame(loop);
      }
      requestAnimationFrame(loop);

      function launch(x, y) {
        const startX = x !== undefined ? x : (Math.random() * canvas.width / DPR);
        const vx = (Math.random() - 0.5) * 1.5;
        const vy = - (5 + Math.random() * 5);
        rockets.push(new Rocket(startX, canvas.height / DPR + 10, vx, vy));
      }
      function launchTowards(x, y) {
        // launch from bottom center aiming near click
        const sx = Math.random() * canvas.width / DPR;
        const sy = canvas.height / DPR + 10;
        const dx = x - sx;
        const dy = y - sy;
        const angle = Math.atan2(dy, dx);
        const speed = Math.min(9, Math.hypot(dx, dy) / 25 + 5);
        const vx = Math.cos(angle) * speed;
        const vy = Math.sin(angle) * speed;
        rockets.push(new Rocket(sx, sy, vx, vy, colors[(Math.random()*colors.length)|0]));
      }
      function launchRandom() {
        const x = Math.random() * canvas.width / DPR;
        const vx = (Math.random()-0.5) * 1.8;
        const vy = - (4 + Math.random()*6);
        rockets.push(new Rocket(x, canvas.height / DPR + 10, vx, vy));
      }

      window.addEventListener('pointerdown', (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = (e.clientX - rect.left);
        const y = (e.clientY - rect.top);
        launchTowards(x, y);
      }, {passive:true});

      // initial batch
      for (let i=0;i<6;i++) launchRandom();

    })();
  </script>
</body>
</html>
<!-- ...existing code... -->
